<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nagarpalika Connect - Social Issue Reporting</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            animation: fadeIn 1s ease;
        }

        .logo i {
            font-size: 2rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 5px;
            transition: var(--transition);
        }

        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .admin-access {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-info {
            display: none;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(44, 62, 80, 0.8), rgba(44, 62, 80, 0.9)), url('https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 5rem 0;
            text-align: center;
            animation: fadeIn 1.5s ease;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: slideUp 1s ease;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            animation: slideUp 1.2s ease;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            animation: slideUp 1.4s ease;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background-color: white;
            color: var(--primary);
        }

        .btn-danger {
            background-color: var(--accent);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* Features Section */
        .features {
            padding: 5rem 0;
            background-color: white;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background-color: var(--secondary);
            margin: 10px auto;
            border-radius: 2px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        /* Report Issue Form */
        .report-section {
            padding: 5rem 0;
            background-color: #f8f9fa;
        }

        .report-form {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload:hover {
            border-color: var(--secondary);
        }

        .file-upload i {
            font-size: 2rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .priority-select {
            display: flex;
            gap: 10px;
        }

        .priority-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .priority-option:hover {
            border-color: var(--secondary);
        }

        .priority-option.selected {
            border-color: var(--secondary);
            background-color: rgba(52, 152, 219, 0.1);
        }

        .priority-low.selected {
            border-color: var(--success);
            background-color: rgba(46, 204, 113, 0.1);
        }

        .priority-medium.selected {
            border-color: var(--warning);
            background-color: rgba(243, 156, 18, 0.1);
        }

        .priority-high.selected {
            border-color: var(--accent);
            background-color: rgba(231, 76, 60, 0.1);
        }

        /* Dashboard */
        .dashboard {
            padding: 5rem 0;
            background-color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-weight: 500;
        }

        .issues-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: var(--shadow);
            border-radius: 10px;
            overflow: hidden;
        }

        .issues-table th, .issues-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .issues-table th {
            background-color: var(--primary);
            color: white;
        }

        .issues-table tr:hover {
            background-color: #f9f9f9;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-inprogress {
            background-color: #cce7ff;
            color: #004085;
        }

        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }

        /* Admin Panel */
        .admin-panel {
            padding: 5rem 0;
            background-color: #f8f9fa;
            display: none;
        }

        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        .admin-sidebar {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .admin-sidebar ul {
            list-style: none;
        }

        .admin-sidebar li {
            margin-bottom: 10px;
        }

        .admin-sidebar a {
            display: block;
            padding: 10px 15px;
            color: var(--dark);
            text-decoration: none;
            border-radius: 5px;
            transition: var(--transition);
        }

        .admin-sidebar a:hover, .admin-sidebar a.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }

        .admin-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 3rem 0 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 2rem;
        }

        .footer-column h3 {
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3:after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 2px;
            background-color: var(--secondary);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column li {
            margin-bottom: 10px;
        }

        .footer-column a {
            color: #ddd;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-column a:hover {
            color: white;
            padding-left: 5px;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* Login Form */
        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        /* Admin Dashboard */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .admin-stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .admin-stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Alert Styles */
        .alert {
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Debug Info */
        .debug-info {
            background: #f8f9fa;
            border-left: 4px solid var(--warning);
            padding: 10px 15px;
            margin: 10px 0;
            font-size: 0.9rem;
            display: none;
        }

        /* Notification Settings Styles */
        .notification-settings {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .notification-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-info h5 {
            margin: 0 0 5px 0;
            color: var(--primary);
        }
        
        .notification-info p {
            margin: 0;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes modalFadeIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .admin-container {
                grid-template-columns: 1fr;
            }

            .priority-select {
                flex-direction: column;
            }

            .admin-access {
                margin-top: 10px;
            }
        }

        /* Settings specific styles */
        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .settings-section h4 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        /* Report Details Styles */
        .report-details-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .report-id {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .report-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .report-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .report-content {
                grid-template-columns: 1fr;
            }
        }

        .report-description {
            grid-column: 1 / -1;
        }

        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .media-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
        }

        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .media-item img, .media-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .media-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            font-size: 0.8rem;
            text-align: center;
        }

        .media-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .media-modal-content {
            max-width: 90%;
            max-height: 80%;
            margin: 0 auto;
        }

        .media-modal-content img, .media-modal-content video {
            max-width: 100%;
            max-height: 80vh;
            display: block;
            margin: 0 auto;
        }

        .media-modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            background: none;
            border: none;
        }

        .media-modal-nav {
            display: flex;
            justify-content: space-between;
            width: 90%;
            margin-top: 20px;
        }

        .media-modal-nav button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .media-modal-nav button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .location-map {
            height: 200px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            border: 1px solid #ddd;
        }

        .location-map i {
            font-size: 3rem;
            color: var(--gray);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .detail-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .detail-card h4 {
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .report-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .report-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .report-card-id {
            font-weight: 700;
            color: var(--primary);
        }

        .report-card-preview {
            height: 150px;
            background-color: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .report-card-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .report-card-preview i {
            font-size: 3rem;
            color: var(--gray);
        }

        .report-card-details {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .report-card-details div {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Excel Export Button */
        .btn-excel {
            background-color: #217346;
            color: white;
        }

        .btn-excel:hover {
            background-color: #1a5c38;
            transform: translateY(-2px);
        }

        /* Print Styles */
        @media print {
            header, footer, .admin-sidebar, .action-buttons {
                display: none !important;
            }
            
            .admin-content {
                box-shadow: none;
                padding: 0;
            }
            
            .detail-card {
                background: white;
                border: 1px solid #ddd;
            }
            
            body {
                background: white;
                color: black;
            }
        }

        /* New Report Highlight */
        .new-report {
            background-color: rgba(52, 152, 219, 0.05);
            border-left: 4px solid var(--secondary);
        }

        .new-report-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: var(--secondary);
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Media Preview Styles */
        .media-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .media-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .media-preview-item img, .media-preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        /* File Upload Progress */
        .upload-progress {
            width: 100%;
            height: 5px;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .upload-progress-bar {
            height: 100%;
            background-color: var(--secondary);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-hands-helping"></i>
                <span>Nagarpalika Connect</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" onclick="showSection('home')">Home</a></li>
                    <li><a href="#report" onclick="showSection('report')">Report Issue</a></li>
                    <li><a href="#dashboard" onclick="showSection('dashboard')">Dashboard</a></li>
                </ul>
            </nav>
            <div class="admin-access">
                <div class="admin-info" id="adminInfo">
                    <i class="fas fa-user-shield"></i>
                    <span id="adminName">Admin</span>
                    <button class="btn btn-outline btn-small" onclick="adminLogout()">Logout</button>
                </div>
                <button class="btn btn-outline btn-small" id="adminLoginBtn" onclick="showLoginModal()">
                    <i class="fas fa-user-shield"></i> Admin Login
                </button>
            </div>
        </div>
    </header>

    <!-- Alert Container -->
    <div class="container">
        <div id="alertContainer"></div>
        <div id="debugInfo" class="debug-info"></div>
    </div>

    <!-- Home Section -->
    <section class="hero" id="home">
        <div class="container">
            <h1>Connecting People with Nagarpalika</h1>
            <p>Report social issues in your community, track their resolution, and help create a better living environment for everyone.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="showSection('report')">Report an Issue</button>
                <button class="btn btn-outline" onclick="showSection('dashboard')">View Dashboard</button>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="home-features">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <h3>Report Issues</h3>
                    <p>Take photos or videos of social issues in your area and submit them with detailed descriptions.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <h3>Track Progress</h3>
                    <p>Monitor the status of your reported issues from submission to resolution.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Community Dashboard</h3>
                    <p>View statistics on reported and resolved issues in your community.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Report Issue Section -->
    <section class="report-section" id="report" style="display: none;">
        <div class="container">
            <h2 class="section-title">Report a Social Issue</h2>
            <div class="report-form">
                <form id="issueForm">
                    <div class="form-group">
                        <label for="issueDescription">Issue Description</label>
                        <textarea class="form-control" id="issueDescription" placeholder="Describe the issue in detail..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="issueLocation">Location</label>
                        <input type="text" class="form-control" id="issueLocation" placeholder="Enter the location of the issue" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Priority Level</label>
                        <div class="priority-select">
                            <div class="priority-option priority-low" data-value="low">
                                <i class="fas fa-arrow-down"></i>
                                <p>Low</p>
                            </div>
                            <div class="priority-option priority-medium" data-value="medium">
                                <i class="fas fa-minus"></i>
                                <p>Medium</p>
                            </div>
                            <div class="priority-option priority-high selected" data-value="high">
                                <i class="fas fa-arrow-up"></i>
                                <p>High</p>
                            </div>
                        </div>
                        <input type="hidden" id="selectedPriority" value="high">
                    </div>
                    
                    <div class="form-group">
                        <label>Upload Media</label>
                        <div class="file-upload" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload images or videos</p>
                            <input type="file" id="mediaUpload" multiple style="display: none;" accept="image/*, video/*">
                        </div>
                        <div class="upload-progress" id="uploadProgress">
                            <div class="upload-progress-bar" id="uploadProgressBar"></div>
                        </div>
                        <div class="media-preview" id="mediaPreview">
                            <!-- Media previews will be added here -->
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">Submit Issue</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard" style="display: none;">
        <div class="container">
            <h2 class="section-title">Community Issues Dashboard</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalIssues">0</div>
                    <div class="stat-label">Total Issues</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="resolvedIssues">0</div>
                    <div class="stat-label">Issues Resolved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="inProgressIssues">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingIssues">0</div>
                    <div class="stat-label">Pending Issues</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 20px;">Recent Issues</h3>
            <div id="dashboardLoading" class="spinner" style="display: none;"></div>
            <table class="issues-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Description</th>
                        <th>Location</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="issuesTableBody">
                    <!-- Issues will be loaded dynamically -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Admin Panel Section -->
    <section class="admin-panel" id="admin-panel">
        <div class="container">
            <h2 class="section-title">Admin Panel</h2>
            
            <div class="admin-container">
                <div class="admin-sidebar">
                    <ul>
                        <li><a href="#" class="active" onclick="showAdminTab('dashboard')">Dashboard</a></li>
                        <li><a href="#" onclick="showAdminTab('issues')">Issues Management</a></li>
                        <li><a href="#" onclick="showAdminTab('reports')">All Reports</a></li>
                        <li><a href="#" onclick="showAdminTab('settings')">Settings</a></li>
                        <li><a href="#" onclick="adminLogout()">Logout</a></li>
                    </ul>
                </div>
                
                <div class="admin-content">
                    <!-- Admin Dashboard Tab -->
                    <div id="admin-dashboard">
                        <h3>Admin Dashboard</h3>
                        <p>Welcome to the Nagarpalika Admin Panel. Here you can manage all reported issues.</p>
                        
                        <div class="admin-stats">
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminTotalIssues">0</div>
                                <div class="admin-stat-label">Total Issues</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminMonthlyIssues">0</div>
                                <div class="admin-stat-label">Issues This Month</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminResolutionRate">0%</div>
                                <div class="admin-stat-label">Resolution Rate</div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-value" id="adminAvgResolution">0</div>
                                <div class="admin-stat-label">Avg. Resolution Days</div>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 30px;">Recent Activity</h4>
                        <div id="adminLoading" class="spinner" style="display: none;"></div>
                        <table class="issues-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Description</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="adminIssuesTableBody">
                                <!-- Admin issues will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Issues Management Tab -->
                    <div id="admin-issues" style="display: none;">
                        <h3>Issues Management</h3>
                        <p>Manage and update the status of reported issues, assign deadlines, and communicate with citizens.</p>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="issueSelect">Select Issue</label>
                            <select class="form-control" id="issueSelect">
                                <option value="">-- Select an issue --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="statusUpdate">Update Issue Status</label>
                            <select class="form-control" id="statusUpdate">
                                <option value="pending">Pending</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="deadline">Set Deadline</label>
                            <input type="date" class="form-control" id="deadline">
                        </div>
                        
                        <div class="form-group">
                            <label for="adminNotes">Admin Notes</label>
                            <textarea class="form-control" id="adminNotes" placeholder="Add notes about this issue..."></textarea>
                        </div>
                        
                        <button class="btn btn-primary" onclick="updateIssueStatus()">Update Issue</button>
                    </div>
                    
                    <!-- All Reports Tab -->
                    <div id="admin-reports" style="display: none;">
                        <div class="report-header">
                            <h3>All Reported Issues</h3>
                            <div>
                                <input type="text" class="form-control" id="reportSearch" placeholder="Search reports..." style="width: 250px; display: inline-block;">
                                <select class="form-control" id="reportFilter" style="width: 150px; display: inline-block; margin-left: 10px;">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                </select>
                                <button class="btn btn-excel" onclick="exportAllReportsToExcel()" style="margin-left: 10px;">
                                    <i class="fas fa-file-excel"></i> Export All to Excel
                                </button>
                            </div>
                        </div>
                        
                        <div id="reportsLoading" class="spinner" style="display: none;"></div>
                        <div class="reports-grid" id="reportsGrid">
                            <!-- Reports will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Report Details View -->
                    <div id="admin-report-details" style="display: none;">
                        <div class="report-header">
                            <h3>Report Details</h3>
                            <button class="btn btn-outline" onclick="showAdminTab('reports')">
                                <i class="fas fa-arrow-left"></i> Back to Reports
                            </button>
                        </div>
                        
                        <div class="report-details-container">
                            <div class="detail-card">
                                <div class="report-header">
                                    <div class="report-id" id="detailReportId">ISSUE-1042</div>
                                    <div class="report-meta">
                                        <span><i class="fas fa-calendar"></i> <span id="detailReportDate">15 Jun 2023</span></span>
                                        <span><i class="fas fa-flag"></i> <span id="detailReportPriority">High</span></span>
                                        <span class="status-badge status-pending" id="detailReportStatus">Pending</span>
                                    </div>
                                </div>
                                
                                <div class="report-content">
                                    <div class="report-description">
                                        <h4><i class="fas fa-align-left"></i> Description</h4>
                                        <p id="detailReportDescription">No description available</p>
                                    </div>
                                    
                                    <div>
                                        <h4><i class="fas fa-map-marker-alt"></i> Location</h4>
                                        <p id="detailReportLocation">No location specified</p>
                                        <div class="location-map">
                                            <i class="fas fa-map"></i>
                                            <span>Map view would be displayed here</span>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4><i class="fas fa-user"></i> Reporter Information</h4>
                                        <p id="detailReportReporter">Anonymous User</p>
                                        <p id="detailReportContact">No contact information</p>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4><i class="fas fa-images"></i> Media Attachments</h4>
                                    <div class="media-gallery" id="detailReportMedia">
                                        <!-- Media items will be added here -->
                                    </div>
                                </div>
                                
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="updateReportStatus('in_progress')">
                                        <i class="fas fa-play-circle"></i> Mark In Progress
                                    </button>
                                    <button class="btn btn-success" onclick="updateReportStatus('completed')">
                                        <i class="fas fa-check-circle"></i> Mark Completed
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteCurrentReport()">
                                        <i class="fas fa-trash"></i> Delete Report
                                    </button>
                                    <button class="btn btn-excel" onclick="exportReportToExcel()">
                                        <i class="fas fa-file-excel"></i> Export to Excel
                                    </button>
                                    <button class="btn btn-outline" onclick="printReport()">
                                        <i class="fas fa-print"></i> Print Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Tab -->
                    <div id="admin-settings" style="display: none;">
                        <h3>Admin Settings</h3>
                        <p>Configure system settings and preferences.</p>
                        
                        <div class="settings-section">
                            <h4>Profile Information</h4>
                            <div class="form-group">
                                <label for="adminNameInput">Admin Name</label>
                                <input type="text" class="form-control" id="adminNameInput" placeholder="Enter admin name">
                            </div>
                            
                            <div class="form-group">
                                <label for="adminEmailInput">Email Address</label>
                                <input type="email" class="form-control" id="adminEmailInput" placeholder="Enter email address">
                            </div>
                            
                            <div class="form-group">
                                <label for="adminPhoneInput">Phone Number</label>
                                <input type="tel" class="form-control" id="adminPhoneInput" placeholder="Enter phone number">
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4>Notification Settings</h4>
                            <div class="notification-settings">
                                <div class="notification-item">
                                    <div class="notification-info">
                                        <h5>Email Notifications</h5>
                                        <p>Receive email alerts for new issues</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="notification-item">
                                    <div class="notification-info">
                                        <h5>SMS Notifications</h5>
                                        <p>Receive SMS alerts for urgent issues</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="smsNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="notification-item">
                                    <div class="notification-info">
                                        <h5>High Priority Alerts</h5>
                                        <p>Get notified immediately for high priority issues</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="urgentAlerts" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="notification-item">
                                    <div class="notification-info">
                                        <h5>Daily Summary</h5>
                                        <p>Receive daily summary of all issues</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="dailySummary">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4>System Preferences</h4>
                            <div class="form-group">
                                <label for="itemsPerPage">Items per page</label>
                                <select class="form-control" id="itemsPerPage">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="defaultPriority">Default Priority for New Issues</label>
                                <select class="form-control" id="defaultPriority">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high" selected>High</option>
                                </select>
                            </div>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="autoAssign" checked>
                                <label for="autoAssign">Auto-assign new issues to available staff</label>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4>Change Password</h4>
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" class="form-control" id="currentPassword" placeholder="Enter current password">
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" class="form-control" id="newPassword" placeholder="Enter new password">
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 30px;">
                            <button class="btn btn-primary" onclick="saveSettings()" id="saveSettingsBtn">Save Settings</button>
                            <button class="btn btn-outline" onclick="resetSettings()" style="margin-left: 10px;">Reset to Defaults</button>
                        </div>
                        
                        <div id="settingsMessage" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Nagarpalika Connect</h3>
                    <p>Bridging the gap between citizens and local government for a better community.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#" onclick="showSection('home')">Home</a></li>
                        <li><a href="#report" onclick="showSection('report')">Report Issue</a></li>
                        <li><a href="#dashboard" onclick="showSection('dashboard')">Dashboard</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Nagarpalika Office, City Center</li>
                        <li><i class="fas fa-phone"></i> +91 98765 43210</li>
                        <li><i class="fas fa-envelope"></i> contact@nagarpalika.org</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Nagarpalika Connect. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin Login</h3>
                <button class="close-modal" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" class="form-control" id="username" placeholder="Enter admin username" value="admin">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter admin password" value="admin123">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="performAdminLogin()" id="loginBtn">Login</button>
                <div class="debug-info" style="margin-top: 15px; display: none;" id="loginDebug">
                    <!-- Debug info will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Issue Reported Successfully!</h3>
                <button class="close-modal" onclick="closeModal('successModal')">&times;</button>
            </div>
            <p>Your issue has been submitted to the Nagarpalika. You can track its status on the dashboard.</p>
            <p>Your reference ID: <strong id="referenceId"></strong></p>
            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="closeModal('successModal')">OK</button>
        </div>
    </div>

    <!-- Admin Success Modal -->
    <div class="modal" id="adminSuccessModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Status Updated Successfully!</h3>
                <button class="close-modal" onclick="closeModal('adminSuccessModal')">&times;</button>
            </div>
            <p>The issue status has been updated. The reporter will be notified of the change.</p>
            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="closeModal('adminSuccessModal')">OK</button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Deletion</h3>
                <button class="close-modal" onclick="closeModal('deleteConfirmModal')">&times;</button>
            </div>
            <p>Are you sure you want to delete this report? This action cannot be undone.</p>
            <p><strong>Report ID: <span id="deleteReportId"></span></strong></p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-danger" style="flex: 1;" onclick="confirmDeleteReport()">Delete</button>
                <button class="btn btn-outline" style="flex: 1;" onclick="closeModal('deleteConfirmModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Media Viewer Modal -->
    <div class="media-modal" id="mediaModal">
        <button class="media-modal-close" onclick="closeMediaModal()">&times;</button>
        <div class="media-modal-content" id="mediaModalContent">
            <!-- Media content will be inserted here -->
        </div>
        <div class="media-modal-nav">
            <button id="mediaPrevBtn" onclick="navigateMedia(-1)"><i class="fas fa-chevron-left"></i> Previous</button>
            <span id="mediaCounter">1 of 5</span>
            <button id="mediaNextBtn" onclick="navigateMedia(1)">Next <i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <script>
        // Global variables
        let isAdminLoggedIn = false;
        let authToken = null;
        let currentAdmin = null;
        let currentMediaIndex = 0;
        let currentMediaItems = [];
        let currentReport = null;
        let db = null;
        let issueCounter = 1000; // Starting ID for issues
        let selectedFiles = []; // Store selected media files
        let reportToDelete = null; // Store report to be deleted

        // Database name and version
        const DB_NAME = 'NagarpalikaDB';
        const DB_VERSION = 2; // Increased version for media storage
        const ISSUES_STORE = 'issues';
        const SETTINGS_STORE = 'settings';
        const MEDIA_STORE = 'media'; // New store for media files

        // Default settings
        const defaultSettings = {
            adminName: "Nagarpalika Admin",
            adminEmail: "admin@nagarpalika.org",
            adminPhone: "+91 98765 43210",
            emailNotifications: true,
            smsNotifications: false,
            urgentAlerts: true,
            dailySummary: false,
            statusUpdates: true,
            weeklyReports: false,
            itemsPerPage: 25,
            defaultPriority: "high",
            autoAssign: true
        };

        // Current settings - initialize from localStorage or use defaults
        let currentSettings = JSON.parse(localStorage.getItem('adminSettings')) || {...defaultSettings};

        // Debug mode
        const DEBUG_MODE = true;

        // Initialize Database
        function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => {
                    console.error('Database failed to open');
                    reject('Database error');
                };
                
                request.onsuccess = () => {
                    db = request.result;
                    console.log('Database opened successfully');
                    
                    // Check if we have any issues, if not, add some sample data
                    checkAndAddSampleData().then(() => {
                        resolve(db);
                    });
                };
                
                request.onupgradeneeded = (e) => {
                    const database = e.target.result;
                    
                    // Create issues store if it doesn't exist
                    if (!database.objectStoreNames.contains(ISSUES_STORE)) {
                        const issuesStore = database.createObjectStore(ISSUES_STORE, { 
                            keyPath: 'id', 
                            autoIncrement: true 
                        });
                        
                        // Create indexes for efficient querying
                        issuesStore.createIndex('reference_id', 'reference_id', { unique: true });
                        issuesStore.createIndex('status', 'status', { unique: false });
                        issuesStore.createIndex('priority', 'priority', { unique: false });
                        issuesStore.createIndex('created_at', 'created_at', { unique: false });
                    }
                    
                    // Create settings store if it doesn't exist
                    if (!database.objectStoreNames.contains(SETTINGS_STORE)) {
                        const settingsStore = database.createObjectStore(SETTINGS_STORE, { 
                            keyPath: 'id'
                        });
                    }
                    
                    // Create media store if it doesn't exist (new in version 2)
                    if (!database.objectStoreNames.contains(MEDIA_STORE)) {
                        const mediaStore = database.createObjectStore(MEDIA_STORE, { 
                            keyPath: 'id',
                            autoIncrement: true
                        });
                        
                        // Create index for media by issue_id
                        mediaStore.createIndex('issue_id', 'issue_id', { unique: false });
                    }
                };
            });
        }

        // Check if we have data and add sample data if empty
        async function checkAndAddSampleData() {
            const issues = await getAllIssues();
            
            if (issues.length === 0) {
                // Add some sample issues
                const sampleIssues = [
                    {
                        reference_id: 'ISSUE-1001',
                        description: 'Garbage accumulation on the roadside causing foul smell and health hazard',
                        location: 'Main Road, City Center',
                        priority: 'high',
                        status: 'pending',
                        created_at: new Date('2023-06-10').toISOString(),
                        media: [],
                        reporter: {
                            name: 'Anonymous User',
                            contact: null
                        }
                    },
                    {
                        reference_id: 'ISSUE-1002',
                        description: 'Street lights not working in the area, causing safety concerns at night',
                        location: 'Gandhi Nagar, Near Park',
                        priority: 'medium',
                        status: 'in_progress',
                        created_at: new Date('2023-06-12').toISOString(),
                        media: [],
                        reporter: {
                            name: 'Registered User',
                            contact: 'user@example.com'
                        }
                    },
                    {
                        reference_id: 'ISSUE-1003',
                        description: 'Potholes on the road causing traffic issues and vehicle damage',
                        location: 'Market Area, Sector 5',
                        priority: 'high',
                        status: 'completed',
                        created_at: new Date('2023-06-05').toISOString(),
                        media: [],
                        reporter: {
                            name: 'Anonymous User',
                            contact: null
                        }
                    }
                ];
                
                for (const issue of sampleIssues) {
                    await addIssue(issue);
                }
                
                console.log('Sample data added to database');
            }
            
            // Update issue counter based on existing data
            if (issues.length > 0) {
                const maxId = Math.max(...issues.map(issue => {
                    const idNum = parseInt(issue.reference_id.split('-')[1]);
                    return isNaN(idNum) ? 1000 : idNum;
                }));
                issueCounter = maxId + 1;
            }
        }

        // Database operations
        function getAllIssues() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([ISSUES_STORE], 'readonly');
                const store = transaction.objectStore(ISSUES_STORE);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    resolve(request.result);
                };
                
                request.onerror = () => {
                    reject('Error fetching issues');
                };
            });
        }

        function getIssuesByStatus(status) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([ISSUES_STORE], 'readonly');
                const store = transaction.objectStore(ISSUES_STORE);
                const index = store.index('status');
                const request = index.getAll(status);
                
                request.onsuccess = () => {
                    resolve(request.result);
                };
                
                request.onerror = () => {
                    reject('Error fetching issues by status');
                };
            });
        }

        function addIssue(issueData) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([ISSUES_STORE], 'readwrite');
                const store = transaction.objectStore(ISSUES_STORE);
                
                // Generate reference ID
                const referenceId = `ISSUE-${issueCounter++}`;
                const issueWithId = {
                    ...issueData,
                    reference_id: referenceId,
                    created_at: new Date().toISOString()
                };
                
                const request = store.add(issueWithId);
                
                request.onsuccess = () => {
                    resolve({
                        success: true,
                        message: 'Issue added successfully',
                        reference_id: referenceId,
                        id: request.result
                    });
                };
                
                request.onerror = () => {
                    reject('Error adding issue to database');
                };
            });
        }

        function updateIssue(issueId, updateData) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([ISSUES_STORE], 'readwrite');
                const store = transaction.objectStore(ISSUES_STORE);
                
                // First get the issue
                const getRequest = store.get(issueId);
                
                getRequest.onsuccess = () => {
                    const issue = getRequest.result;
                    if (!issue) {
                        reject('Issue not found');
                        return;
                    }
                    
                    // Update the issue
                    const updatedIssue = { ...issue, ...updateData };
                    const putRequest = store.put(updatedIssue);
                    
                    putRequest.onsuccess = () => {
                        resolve({
                            success: true,
                            message: 'Issue updated successfully'
                        });
                    };
                    
                    putRequest.onerror = () => {
                        reject('Error updating issue');
                    };
                };
                
                getRequest.onerror = () => {
                    reject('Error fetching issue for update');
                };
            });
        }

        function getIssueById(issueId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([ISSUES_STORE], 'readonly');
                const store = transaction.objectStore(ISSUES_STORE);
                const request = store.get(issueId);
                
                request.onsuccess = () => {
                    resolve(request.result);
                };
                
                request.onerror = () => {
                    reject('Error fetching issue');
                };
            });
        }

        // DELETE issue function
        function deleteIssue(issueId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([ISSUES_STORE], 'readwrite');
                const store = transaction.objectStore(ISSUES_STORE);
                
                const request = store.delete(issueId);
                
                request.onsuccess = () => {
                    resolve({
                        success: true,
                        message: 'Issue deleted successfully'
                    });
                };
                
                request.onerror = () => {
                    reject('Error deleting issue');
                };
            });
        }

        // DELETE media files for an issue
        function deleteMediaForIssue(issueId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([MEDIA_STORE], 'readwrite');
                const store = transaction.objectStore(MEDIA_STORE);
                const index = store.index('issue_id');
                
                const request = index.getAllKeys(issueId);
                
                request.onsuccess = () => {
                    const keys = request.result;
                    let deleteCount = 0;
                    
                    if (keys.length === 0) {
                        resolve({
                            success: true,
                            message: 'No media files to delete',
                            count: 0
                        });
                        return;
                    }
                    
                    keys.forEach(key => {
                        const deleteRequest = store.delete(key);
                        
                        deleteRequest.onsuccess = () => {
                            deleteCount++;
                            if (deleteCount === keys.length) {
                                resolve({
                                    success: true,
                                    message: `Deleted ${deleteCount} media files`,
                                    count: deleteCount
                                });
                            }
                        };
                        
                        deleteRequest.onerror = () => {
                            reject('Error deleting media file');
                        };
                    });
                };
                
                request.onerror = () => {
                    reject('Error fetching media files for deletion');
                };
            });
        }

        // Media file operations
        function saveMediaFile(issueId, file) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([MEDIA_STORE], 'readwrite');
                const store = transaction.objectStore(MEDIA_STORE);
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const mediaData = {
                        issue_id: issueId,
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: e.target.result, // Base64 encoded data
                        uploaded_at: new Date().toISOString()
                    };
                    
                    const request = store.add(mediaData);
                    
                    request.onsuccess = () => {
                        resolve({
                            success: true,
                            message: 'Media file saved successfully',
                            id: request.result
                        });
                    };
                    
                    request.onerror = () => {
                        reject('Error saving media file');
                    };
                };
                
                reader.onerror = () => {
                    reject('Error reading file');
                };
                
                reader.readAsDataURL(file);
            });
        }

        function getMediaByIssueId(issueId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([MEDIA_STORE], 'readonly');
                const store = transaction.objectStore(MEDIA_STORE);
                const index = store.index('issue_id');
                const request = index.getAll(issueId);
                
                request.onsuccess = () => {
                    resolve(request.result);
                };
                
                request.onerror = () => {
                    reject('Error fetching media files');
                };
            });
        }

        function getMediaById(mediaId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([MEDIA_STORE], 'readonly');
                const store = transaction.objectStore(MEDIA_STORE);
                const request = store.get(mediaId);
                
                request.onsuccess = () => {
                    resolve(request.result);
                };
                
                request.onerror = () => {
                    reject('Error fetching media file');
                };
            });
        }

        // Show debug info
        function showDebugInfo(message) {
            if (!DEBUG_MODE) return;
            
            const debugElement = document.getElementById('debugInfo');
            debugElement.innerHTML = `<strong>Debug:</strong> ${message}`;
            debugElement.style.display = 'block';
            console.log('DEBUG:', message);
        }

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;
            alertContainer.style.display = 'block';
            
            setTimeout(() => {
                alertContainer.style.display = 'none';
            }, 5000);
        }

        // Show loading spinner
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'block';
            }
        }

        // Hide loading spinner
        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'none';
            }
        }

        // SIMULATED API - Updated to use database
        const simulatedAPI = {
            // Simulated login function
            login: async function(username, password) {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Check credentials
                if (username === 'admin' && password === 'admin123') {
                    return {
                        success: true,
                        message: 'Login successful',
                        token: 'simulated-jwt-token-' + Date.now(),
                        admin: {
                            id: 1,
                            username: 'admin',
                            full_name: 'Nagarpalika Administrator',
                            email: 'admin@nagarpalika.org'
                        }
                    };
                } else {
                    return {
                        success: false,
                        error: 'Invalid username or password'
                    };
                }
            },
            
            // Get stats from database
            getStats: async function() {
                const issues = await getAllIssues();
                
                const total = issues.length;
                const completed = issues.filter(issue => issue.status === 'completed').length;
                const inprogress = issues.filter(issue => issue.status === 'in_progress').length;
                const pending = issues.filter(issue => issue.status === 'pending').length;
                
                // Calculate resolution rate
                const resolution_rate = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                // Count issues from today
                const today = new Date().toISOString().split('T')[0];
                const today_issues = issues.filter(issue => 
                    issue.created_at.split('T')[0] === today
                ).length;
                
                return {
                    total,
                    completed,
                    inprogress,
                    pending,
                    today_issues,
                    resolution_rate
                };
            },
            
            // Get issues from database
            getIssues: async function(limit = 10) {
                const issues = await getAllIssues();
                
                // Sort by creation date (newest first)
                issues.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
                // Apply limit
                return issues.slice(0, limit);
            },
            
            // Simulated send email notification
            sendEmailNotification: async function(adminEmail, issueData) {
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // In a real application, this would send an actual email
                console.log(`Email sent to ${adminEmail}: New issue reported - ${issueData.reference_id}`);
                
                return {
                    success: true,
                    message: 'Email notification sent successfully'
                };
            },
            
            // Simulated send SMS notification
            sendSMSNotification: async function(adminPhone, issueData) {
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // In a real application, this would send an actual SMS
                console.log(`SMS sent to ${adminPhone}: New issue reported - ${issueData.reference_id}`);
                
                return {
                    success: true,
                    message: 'SMS notification sent successfully'
                };
            },
            
            // Submit issue to database
            submitIssue: async function(issueData, mediaFiles = []) {
                try {
                    // First add the issue
                    const result = await addIssue(issueData);
                    
                    // Then save media files if any
                    if (mediaFiles.length > 0) {
                        for (const file of mediaFiles) {
                            await saveMediaFile(result.id, file);
                        }
                    }
                    
                    return result;
                } catch (error) {
                    throw new Error(error);
                }
            },
            
            // Update issue in database
            updateIssue: async function(issueId, updateData) {
                try {
                    const result = await updateIssue(issueId, updateData);
                    return result;
                } catch (error) {
                    throw new Error(error);
                }
            },
            
            // Delete issue from database
            deleteIssue: async function(issueId) {
                try {
                    // First delete associated media files
                    await deleteMediaForIssue(issueId);
                    
                    // Then delete the issue itself
                    const result = await deleteIssue(issueId);
                    return result;
                } catch (error) {
                    throw new Error(error);
                }
            },
            
            // Get media files for an issue
            getMediaForIssue: async function(issueId) {
                try {
                    const mediaFiles = await getMediaByIssueId(issueId);
                    return mediaFiles;
                } catch (error) {
                    throw new Error(error);
                }
            },
            
            // Simulated save settings
            saveSettings: async function(settings) {
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Save to localStorage
                localStorage.setItem('adminSettings', JSON.stringify(settings));
                
                // Return success response
                return {
                    success: true,
                    message: 'Settings saved successfully'
                };
            },
            
            // Simulated get settings
            getSettings: async function() {
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Get from localStorage or return defaults
                const savedSettings = localStorage.getItem('adminSettings');
                return savedSettings ? JSON.parse(savedSettings) : {...defaultSettings};
            }
        };

        // Excel Export Functionality
        function exportToExcel(data, filename) {
            // Create CSV content
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Add headers
            const headers = Object.keys(data[0]);
            csvContent += headers.join(",") + "\r\n";
            
            // Add data rows
            data.forEach(item => {
                const row = headers.map(header => {
                    // Handle special characters and commas in data
                    let cell = item[header] || '';
                    if (typeof cell === 'string' && cell.includes(',')) {
                        cell = `"${cell}"`;
                    }
                    return cell;
                });
                csvContent += row.join(",") + "\r\n";
            });
            
            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            
            // Trigger download
            link.click();
            document.body.removeChild(link);
            
            showAlert(`Report exported successfully as ${filename}`);
        }

        // Export single report to Excel
        function exportReportToExcel() {
            if (!currentReport) {
                showAlert('No report data available to export', 'error');
                return;
            }
            
            const reportData = [{
                'Report ID': currentReport.reference_id,
                'Description': currentReport.description,
                'Location': currentReport.location,
                'Priority': currentReport.priority.charAt(0).toUpperCase() + currentReport.priority.slice(1),
                'Status': currentReport.status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
                'Reported Date': new Date(currentReport.created_at).toLocaleDateString(),
                'Reporter Name': currentReport.reporter?.name || 'Anonymous',
                'Reporter Contact': currentReport.reporter?.contact || 'Not provided',
                'Media Files': currentReport.media ? currentReport.media.length : 0,
                'Media Details': currentReport.media ? currentReport.media.map(m => m.name).join('; ') : 'No media'
            }];
            
            const filename = `Report_${currentReport.reference_id}_${new Date().toISOString().split('T')[0]}.csv`;
            exportToExcel(reportData, filename);
        }

        // Export all reports to Excel
        function exportAllReportsToExcel() {
            // Get all reports from the database
            simulatedAPI.getIssues(1000).then(issues => {
                if (issues.length === 0) {
                    showAlert('No reports available to export', 'error');
                    return;
                }
                
                const reportData = issues.map(issue => ({
                    'Report ID': issue.reference_id,
                    'Description': issue.description,
                    'Location': issue.location,
                    'Priority': issue.priority.charAt(0).toUpperCase() + issue.priority.slice(1),
                    'Status': issue.status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
                    'Reported Date': new Date(issue.created_at).toLocaleDateString(),
                    'Reporter Name': issue.reporter?.name || 'Anonymous',
                    'Media Files': issue.media ? issue.media.length : 0
                }));
                
                const filename = `All_Reports_${new Date().toISOString().split('T')[0]}.csv`;
                exportToExcel(reportData, filename);
            });
        }

        // Print report
        function printReport() {
            window.print();
        }

        // Priority selection
        document.querySelectorAll('.priority-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.priority-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                document.getElementById('selectedPriority').value = this.getAttribute('data-value');
            });
        });

        // File upload display
        document.getElementById('fileUploadArea').addEventListener('click', function() {
            document.getElementById('mediaUpload').click();
        });

        // Handle file selection
        document.getElementById('mediaUpload').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const mediaPreview = document.getElementById('mediaPreview');
            
            // Add new files to selectedFiles array
            selectedFiles = [...selectedFiles, ...files];
            
            // Update preview
            updateMediaPreview();
            
            // Show upload progress
            document.getElementById('uploadProgress').style.display = 'block';
            
            // Simulate upload progress
            let progress = 0;
            const progressBar = document.getElementById('uploadProgressBar');
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('uploadProgress').style.display = 'none';
                        progressBar.style.width = '0%';
                    }, 500);
                }
            }, 100);
        });

        // Update media preview
        function updateMediaPreview() {
            const mediaPreview = document.getElementById('mediaPreview');
            mediaPreview.innerHTML = '';
            
            selectedFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'media-preview-item';
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    previewItem.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.controls = true;
                    previewItem.appendChild(video);
                } else {
                    const icon = document.createElement('i');
                    icon.className = 'fas fa-file';
                    previewItem.appendChild(icon);
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-media';
                removeBtn.innerHTML = '';
                removeBtn.onclick = () => removeMediaFile(index);
                
                previewItem.appendChild(removeBtn);
                mediaPreview.appendChild(previewItem);
            });
        }

        // Remove media file from selection
        function removeMediaFile(index) {
            selectedFiles.splice(index, 1);
            updateMediaPreview();
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                showLoading('dashboardLoading');
                const stats = await simulatedAPI.getStats();
                const issues = await simulatedAPI.getIssues(10);
                
                // Update stats cards
                document.getElementById('totalIssues').textContent = stats.total || 0;
                document.getElementById('resolvedIssues').textContent = stats.completed || 0;
                document.getElementById('inProgressIssues').textContent = stats.inprogress || 0;
                document.getElementById('pendingIssues').textContent = stats.pending || 0;

                // Update issues table
                updateIssuesTable(issues);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showAlert('Error loading dashboard data: ' + error.message, 'error');
            } finally {
                hideLoading('dashboardLoading');
            }
        }

        // Update issues table
        function updateIssuesTable(issues) {
            const tbody = document.getElementById('issuesTableBody');
            tbody.innerHTML = '';
            
            if (!issues || issues.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">
                            No issues reported yet. Be the first to report an issue!
                        </td>
                    </tr>
                `;
                return;
            }
            
            issues.forEach(issue => {
                const row = document.createElement('tr');
                const statusClass = `status-${issue.status}`;
                const statusText = issue.status ? issue.status.split('_').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ') : 'Unknown';
                
                // Check if this is a new report (created today)
                const isNew = new Date(issue.created_at).toDateString() === new Date().toDateString();
                
                if (isNew) {
                    row.classList.add('new-report');
                }
                
                row.innerHTML = `
                    <td>
                        ${isNew ? '<span class="new-report-indicator"></span>' : ''}
                        ${issue.reference_id || 'N/A'}
                    </td>
                    <td>${issue.description || 'No description'}</td>
                    <td>${issue.location || 'Unknown location'}</td>
                    <td>${issue.created_at ? new Date(issue.created_at).toLocaleDateString() : 'Unknown date'}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load admin data
        async function loadAdminData() {
            try {
                showLoading('adminLoading');
                const stats = await simulatedAPI.getStats();
                const issues = await simulatedAPI.getIssues(20);
                
                document.getElementById('adminTotalIssues').textContent = stats.total || 0;
                document.getElementById('adminMonthlyIssues').textContent = stats.today_issues || 0;
                document.getElementById('adminResolutionRate').textContent = (stats.resolution_rate || 0) + '%';
                document.getElementById('adminAvgResolution').textContent = '5.2';

                updateAdminIssuesTable(issues);
                populateIssueSelect(issues);
                
            } catch (error) {
                console.error('Error loading admin data:', error);
                showAlert('Error loading admin data: ' + error.message, 'error');
            } finally {
                hideLoading('adminLoading');
            }
        }

        // Update admin issues table
        function updateAdminIssuesTable(issues) {
            const tbody = document.getElementById('adminIssuesTableBody');
            tbody.innerHTML = '';
            
            if (!issues || issues.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">
                            No issues to display
                        </td>
                    </tr>
                `;
                return;
            }
            
            issues.forEach(issue => {
                const row = document.createElement('tr');
                const statusClass = `status-${issue.status}`;
                const statusText = issue.status ? issue.status.split('_').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ') : 'Unknown';
                const priorityColor = issue.priority === 'high' ? 'var(--accent)' : 
                                   issue.priority === 'medium' ? 'var(--warning)' : 'var(--success)';
                
                row.innerHTML = `
                    <td>${issue.reference_id || 'N/A'}</td>
                    <td>${(issue.description || '').substring(0, 60)}...</td>
                    <td><span style="color: ${priorityColor};">${(issue.priority || 'medium').charAt(0).toUpperCase() + (issue.priority || 'medium').slice(1)}</span></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-primary btn-small" onclick="selectIssue(${issue.id})">Manage</button>
                        <button class="btn btn-outline btn-small" onclick="viewReportDetails(${issue.id})">View Details</button>
                        <button class="btn btn-danger btn-small" onclick="promptDeleteReport(${issue.id}, '${issue.reference_id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load all reports for the reports tab
        async function loadAllReports() {
            try {
                showLoading('reportsLoading');
                const issues = await simulatedAPI.getIssues(50);
                displayReportsGrid(issues);
                
            } catch (error) {
                console.error('Error loading reports:', error);
                showAlert('Error loading reports: ' + error.message, 'error');
            } finally {
                hideLoading('reportsLoading');
            }
        }

        // Display reports in grid view
        function displayReportsGrid(issues) {
            const reportsGrid = document.getElementById('reportsGrid');
            reportsGrid.innerHTML = '';
            
            if (!issues || issues.length === 0) {
                reportsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--gray); margin-bottom: 15px;"></i>
                        <h3>No Reports Found</h3>
                        <p>There are no reported issues to display.</p>
                    </div>
                `;
                return;
            }
            
            issues.forEach(issue => {
                const reportCard = document.createElement('div');
                reportCard.className = 'report-card';
                reportCard.onclick = () => viewReportDetails(issue.id);
                
                // Get media files for preview
                simulatedAPI.getMediaForIssue(issue.id).then(mediaFiles => {
                    const previewMedia = mediaFiles.length > 0 ? mediaFiles[0] : null;
                    
                    reportCard.innerHTML = `
                        <div class="report-card-header">
                            <div class="report-card-id">${issue.reference_id}</div>
                            <span class="status-badge status-${issue.status}">${issue.status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</span>
                        </div>
                        
                        <div class="report-card-preview">
                            ${previewMedia ? 
                                (previewMedia.type.startsWith('image/') ? 
                                    `<img src="${previewMedia.data}" alt="Issue preview">` :
                                    `<video><source src="${previewMedia.data}" type="${previewMedia.type}"></video>`
                                ) : 
                                `<i class="fas fa-image"></i>`
                            }
                        </div>
                        
                        <div class="report-card-details">
                            <div><i class="fas fa-align-left"></i> ${(issue.description || '').substring(0, 80)}${issue.description && issue.description.length > 80 ? '...' : ''}</div>
                            <div><i class="fas fa-map-marker-alt"></i> ${issue.location}</div>
                            <div><i class="fas fa-flag" style="color: ${issue.priority === 'high' ? 'var(--accent)' : issue.priority === 'medium' ? 'var(--warning)' : 'var(--success)'}"></i> ${issue.priority.charAt(0).toUpperCase() + issue.priority.slice(1)} Priority</div>
                            <div><i class="fas fa-calendar"></i> ${new Date(issue.created_at).toLocaleDateString()}</div>
                            <div><i class="fas fa-camera"></i> ${mediaFiles.length} media files</div>
                        </div>
                        <div class="action-buttons" style="margin-top: 10px;">
                            <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); promptDeleteReport(${issue.id}, '${issue.reference_id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                }).catch(error => {
                    console.error('Error loading media for issue:', error);
                    
                    reportCard.innerHTML = `
                        <div class="report-card-header">
                            <div class="report-card-id">${issue.reference_id}</div>
                            <span class="status-badge status-${issue.status}">${issue.status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</span>
                        </div>
                        
                        <div class="report-card-preview">
                            <i class="fas fa-image"></i>
                        </div>
                        
                        <div class="report-card-details">
                            <div><i class="fas fa-align-left"></i> ${(issue.description || '').substring(0, 80)}${issue.description && issue.description.length > 80 ? '...' : ''}</div>
                            <div><i class="fas fa-map-marker-alt"></i> ${issue.location}</div>
                            <div><i class="fas fa-flag" style="color: ${issue.priority === 'high' ? 'var(--accent)' : issue.priority === 'medium' ? 'var(--warning)' : 'var(--success)'}"></i> ${issue.priority.charAt(0).toUpperCase() + issue.priority.slice(1)} Priority</div>
                            <div><i class="fas fa-calendar"></i> ${new Date(issue.created_at).toLocaleDateString()}</div>
                            <div><i class="fas fa-camera"></i> 0 media files</div>
                        </div>
                        <div class="action-buttons" style="margin-top: 10px;">
                            <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); promptDeleteReport(${issue.id}, '${issue.reference_id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                });
                
                reportsGrid.appendChild(reportCard);
            });
        }

        // View report details
        async function viewReportDetails(issueId) {
            try {
                const issue = await getIssueById(issueId);
                const mediaFiles = await simulatedAPI.getMediaForIssue(issueId);
                
                if (!issue) {
                    showAlert('Report not found', 'error');
                    return;
                }
                
                // Store current report for export
                currentReport = issue;
                
                // Update report details view
                document.getElementById('detailReportId').textContent = issue.reference_id;
                document.getElementById('detailReportDate').textContent = new Date(issue.created_at).toLocaleDateString();
                document.getElementById('detailReportPriority').textContent = issue.priority.charAt(0).toUpperCase() + issue.priority.slice(1);
                document.getElementById('detailReportStatus').textContent = issue.status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                document.getElementById('detailReportStatus').className = `status-badge status-${issue.status}`;
                document.getElementById('detailReportDescription').textContent = issue.description || 'No description available';
                document.getElementById('detailReportLocation').textContent = issue.location || 'No location specified';
                document.getElementById('detailReportReporter').textContent = issue.reporter?.name || 'Anonymous User';
                document.getElementById('detailReportContact').textContent = issue.reporter?.contact || 'No contact information';
                
                // Update media gallery
                const mediaGallery = document.getElementById('detailReportMedia');
                mediaGallery.innerHTML = '';
                
                if (mediaFiles.length > 0) {
                    mediaFiles.forEach((media, index) => {
                        const mediaItem = document.createElement('div');
                        mediaItem.className = 'media-item';
                        mediaItem.onclick = () => openMediaViewer(mediaFiles, index);
                        
                        if (media.type.startsWith('image/')) {
                            mediaItem.innerHTML = `
                                <img src="${media.data}" alt="Issue media ${index + 1}">
                                <div class="media-overlay">Image ${index + 1}</div>
                            `;
                        } else if (media.type.startsWith('video/')) {
                            mediaItem.innerHTML = `
                                <video>
                                    <source src="${media.data}" type="${media.type}">
                                    Your browser does not support the video tag.
                                </video>
                                <div class="media-overlay">Video ${index + 1}</div>
                            `;
                        } else {
                            mediaItem.innerHTML = `
                                <i class="fas fa-file"></i>
                                <div class="media-overlay">File ${index + 1}</div>
                            `;
                        }
                        
                        mediaGallery.appendChild(mediaItem);
                    });
                } else {
                    mediaGallery.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--gray);">
                            <i class="fas fa-images" style="font-size: 3rem; margin-bottom: 10px;"></i>
                            <p>No media attachments</p>
                        </div>
                    `;
                }
                
                // Show report details view
                showAdminTab('report-details');
                
            } catch (error) {
                console.error('Error loading report details:', error);
                showAlert('Error loading report details: ' + error.message, 'error');
            }
        }

        // Open media viewer
        function openMediaViewer(mediaItems, index) {
            currentMediaItems = mediaItems;
            currentMediaIndex = index;
            
            const mediaModal = document.getElementById('mediaModal');
            const mediaModalContent = document.getElementById('mediaModalContent');
            
            // Display current media
            displayCurrentMedia();
            
            // Show modal
            mediaModal.style.display = 'flex';
        }

        // Display current media in modal
        function displayCurrentMedia() {
            const mediaModalContent = document.getElementById('mediaModalContent');
            const mediaCounter = document.getElementById('mediaCounter');
            const mediaPrevBtn = document.getElementById('mediaPrevBtn');
            const mediaNextBtn = document.getElementById('mediaNextBtn');
            
            if (currentMediaItems.length === 0) return;
            
            const media = currentMediaItems[currentMediaIndex];
            
            if (media.type.startsWith('image/')) {
                mediaModalContent.innerHTML = `<img src="${media.data}" alt="Issue media ${currentMediaIndex + 1}">`;
            } else if (media.type.startsWith('video/')) {
                mediaModalContent.innerHTML = `
                    <video controls autoplay>
                        <source src="${media.data}" type="${media.type}">
                        Your browser does not support the video tag.
                    </video>
                `;
            } else {
                mediaModalContent.innerHTML = `<p>File: ${media.name}</p>`;
            }
            
            // Update counter
            mediaCounter.textContent = `${currentMediaIndex + 1} of ${currentMediaItems.length}`;
            
            // Update button states
            mediaPrevBtn.disabled = currentMediaIndex === 0;
            mediaNextBtn.disabled = currentMediaIndex === currentMediaItems.length - 1;
        }

        // Navigate media in modal
        function navigateMedia(direction) {
            currentMediaIndex += direction;
            
            if (currentMediaIndex < 0) {
                currentMediaIndex = 0;
            } else if (currentMediaIndex >= currentMediaItems.length) {
                currentMediaIndex = currentMediaItems.length - 1;
            }
            
            displayCurrentMedia();
        }

        // Close media modal
        function closeMediaModal() {
            document.getElementById('mediaModal').style.display = 'none';
        }

        // Update report status from details view
        function updateReportStatus(newStatus) {
            // In a real app, this would update the status via API
            const statusElement = document.getElementById('detailReportStatus');
            statusElement.textContent = newStatus.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            statusElement.className = `status-badge status-${newStatus}`;
            
            showAlert(`Report status updated to ${newStatus.replace('_', ' ')}`);
        }

        // Populate issue select dropdown
        function populateIssueSelect(issues) {
            const select = document.getElementById('issueSelect');
            select.innerHTML = '<option value="">-- Select an issue --</option>';
            
            if (!issues || issues.length === 0) return;
            
            issues.forEach(issue => {
                const option = document.createElement('option');
                option.value = issue.id;
                option.textContent = `${issue.reference_id || 'N/A'} - ${(issue.description || '').substring(0, 50)}...`;
                select.appendChild(option);
            });
        }

        // Select issue for editing
        function selectIssue(issueId) {
            document.getElementById('issueSelect').value = issueId;
            showAdminTab('issues');
        }

        // Submit issue form - updated to send notifications and save media
        async function submitIssue(formData) {
            try {
                const result = await simulatedAPI.submitIssue(formData, selectedFiles);
                
                // Show success modal
                document.getElementById('referenceId').textContent = result.reference_id || 'N/A';
                document.getElementById('successModal').style.display = 'flex';
                
                // Send notifications to admin if enabled
                await sendAdminNotifications({
                    ...formData,
                    reference_id: result.reference_id,
                    created_at: new Date().toISOString()
                });
                
                // Reload dashboard data to show the new report at the top
                loadDashboardData();
                if (isAdminLoggedIn) {
                    loadAdminData();
                    loadAllReports();
                }
                
                // Reset form and clear selected files
                document.getElementById('issueForm').reset();
                selectedFiles = [];
                updateMediaPreview();
                
                // Reset priority to default
                document.querySelectorAll('.priority-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.querySelector('.priority-high').classList.add('selected');
                document.getElementById('selectedPriority').value = 'high';
                
                showAlert('Issue reported successfully!');
                
            } catch (error) {
                console.error('Error submitting issue:', error);
                showAlert('Error submitting issue: ' + error.message, 'error');
            }
        }

        // Send notifications to admin
        async function sendAdminNotifications(issueData) {
            try {
                // Get admin settings
                const settings = await simulatedAPI.getSettings();
                
                // Send email notification if enabled
                if (settings.emailNotifications && settings.adminEmail) {
                    await simulatedAPI.sendEmailNotification(settings.adminEmail, issueData);
                    showDebugInfo(`Email notification sent to ${settings.adminEmail}`);
                }
                
                // Send SMS notification if enabled and for high priority issues
                if (settings.smsNotifications && settings.adminPhone && 
                    (issueData.priority === 'high' || settings.urgentAlerts)) {
                    await simulatedAPI.sendSMSNotification(settings.adminPhone, issueData);
                    showDebugInfo(`SMS notification sent to ${settings.adminPhone}`);
                }
                
            } catch (error) {
                console.error('Error sending notifications:', error);
                // Don't show error to user, just log it
                showDebugInfo(`Notification error: ${error.message}`);
            }
        }

        // Prompt for report deletion
        function promptDeleteReport(issueId, referenceId) {
            reportToDelete = issueId;
            document.getElementById('deleteReportId').textContent = referenceId;
            document.getElementById('deleteConfirmModal').style.display = 'flex';
        }

        // Confirm and delete report
        async function confirmDeleteReport() {
            if (!reportToDelete) return;
            
            try {
                const result = await simulatedAPI.deleteIssue(reportToDelete);
                
                closeModal('deleteConfirmModal');
                showAlert('Report deleted successfully!');
                
                // Reload data
                loadDashboardData();
                if (isAdminLoggedIn) {
                    loadAdminData();
                    loadAllReports();
                }
                
                // If we're in the report details view, go back to reports list
                if (document.getElementById('admin-report-details').style.display !== 'none') {
                    showAdminTab('reports');
                }
                
                reportToDelete = null;
                
            } catch (error) {
                console.error('Error deleting report:', error);
                showAlert('Error deleting report: ' + error.message, 'error');
            }
        }

        // Delete current report from details view
        function deleteCurrentReport() {
            if (currentReport) {
                promptDeleteReport(currentReport.id, currentReport.reference_id);
            }
        }

        // Load settings into the form - updated for notification settings
        async function loadSettings() {
            try {
                // Get settings from simulated API
                const settings = await simulatedAPI.getSettings();
                
                // Update form fields with current settings
                document.getElementById('adminNameInput').value = settings.adminName || '';
                document.getElementById('adminEmailInput').value = settings.adminEmail || '';
                document.getElementById('adminPhoneInput').value = settings.adminPhone || '';
                
                // Update notification toggles
                document.getElementById('emailNotifications').checked = settings.emailNotifications || false;
                document.getElementById('smsNotifications').checked = settings.smsNotifications || false;
                document.getElementById('urgentAlerts').checked = settings.urgentAlerts || false;
                document.getElementById('dailySummary').checked = settings.dailySummary || false;
                
                document.getElementById('statusUpdates').checked = settings.statusUpdates || false;
                document.getElementById('weeklyReports').checked = settings.weeklyReports || false;
                
                document.getElementById('itemsPerPage').value = settings.itemsPerPage || 25;
                document.getElementById('defaultPriority').value = settings.defaultPriority || 'high';
                document.getElementById('autoAssign').checked = settings.autoAssign || false;
                
                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                showDebugInfo('Settings loaded successfully');
                
            } catch (error) {
                console.error('Error loading settings:', error);
                showSettingsMessage('Error loading settings: ' + error.message, 'error');
            }
        }

        // Save settings function - updated for notification settings
        async function saveSettings() {
            try {
                // Show loading state
                const saveBtn = document.getElementById('saveSettingsBtn');
                const originalText = saveBtn.textContent;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                saveBtn.disabled = true;
                
                // Collect settings from form
                const settings = {
                    adminName: document.getElementById('adminNameInput').value,
                    adminEmail: document.getElementById('adminEmailInput').value,
                    adminPhone: document.getElementById('adminPhoneInput').value,
                    emailNotifications: document.getElementById('emailNotifications').checked,
                    smsNotifications: document.getElementById('smsNotifications').checked,
                    urgentAlerts: document.getElementById('urgentAlerts').checked,
                    dailySummary: document.getElementById('dailySummary').checked,
                    statusUpdates: document.getElementById('statusUpdates').checked,
                    weeklyReports: document.getElementById('weeklyReports').checked,
                    itemsPerPage: document.getElementById('itemsPerPage').value,
                    defaultPriority: document.getElementById('defaultPriority').value,
                    autoAssign: document.getElementById('autoAssign').checked
                };
                
                // Validate required fields
                if (!settings.adminName || !settings.adminEmail) {
                    throw new Error('Admin name and email are required');
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(settings.adminEmail)) {
                    throw new Error('Please enter a valid email address');
                }
                
                // Validate phone number if SMS notifications are enabled
                if (settings.smsNotifications && settings.adminPhone) {
                    const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
                    if (!phoneRegex.test(settings.adminPhone.replace(/[\s\-\(\)]/g, ''))) {
                        throw new Error('Please enter a valid phone number for SMS notifications');
                    }
                }
                
                // Check if password is being changed
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (currentPassword || newPassword || confirmPassword) {
                    // Password change requested
                    if (!currentPassword) {
                        throw new Error('Please enter your current password to change it');
                    }
                    
                    if (newPassword !== confirmPassword) {
                        throw new Error('New passwords do not match');
                    }
                    
                    if (newPassword.length < 6) {
                        throw new Error('New password must be at least 6 characters long');
                    }
                    
                    // In a real app, you would verify the current password and update it
                    settings.passwordChanged = true;
                }
                
                // Save settings using simulated API
                const result = await simulatedAPI.saveSettings(settings);
                
                // Update global settings
                currentSettings = {...settings};
                
                // Update admin name in header if changed
                if (currentAdmin && settings.adminName !== currentAdmin.full_name) {
                    currentAdmin.full_name = settings.adminName;
                    document.getElementById('adminName').textContent = settings.adminName;
                    localStorage.setItem('adminData', JSON.stringify(currentAdmin));
                }
                
                // Show success message
                showSettingsMessage('Settings saved successfully!', 'success');
                
                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                showDebugInfo('Settings saved: ' + JSON.stringify(settings));
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showSettingsMessage('Error saving settings: ' + error.message, 'error');
            } finally {
                // Reset button state
                const saveBtn = document.getElementById('saveSettingsBtn');
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }

        // Reset settings to defaults
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to their default values?')) {
                currentSettings = {...defaultSettings};
                // Save the reset settings
                localStorage.setItem('adminSettings', JSON.stringify(currentSettings));
                loadSettings();
                showSettingsMessage('Settings reset to defaults', 'success');
            }
        }

        // Show message in settings tab
        function showSettingsMessage(message, type = 'success') {
            const messageElement = document.getElementById('settingsMessage');
            messageElement.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;
            messageElement.style.display = 'block';
            
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }

        // Admin login function
        async function performAdminLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginDebug = document.getElementById('loginDebug');
            
            if (!username || !password) {
                showAlert('Please enter both username and password', 'error');
                return;
            }
            
            try {
                // Show loading state
                const loginBtn = document.getElementById('loginBtn');
                const originalText = loginBtn.textContent;
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                loginBtn.disabled = true;
                
                loginDebug.style.display = 'block';
                loginDebug.innerHTML = '<strong>Login Process:</strong><br>1. Preparing login data...';
                
                // Use simulated API for login
                loginDebug.innerHTML += '<br>2. Sending login request...';
                
                const result = await simulatedAPI.login(username, password);
                
                loginDebug.innerHTML += '<br>3. Login request sent, processing response...';
                showDebugInfo(`Login response: ${JSON.stringify(result)}`);
                
                if (result.success) {
                    loginDebug.innerHTML += '<br>4. Login successful!';
                    
                    isAdminLoggedIn = true;
                    authToken = result.token;
                    currentAdmin = result.admin;
                    localStorage.setItem('adminToken', authToken);
                    localStorage.setItem('adminData', JSON.stringify(currentAdmin));
                    
                    // Load settings and update admin name if available
                    const savedSettings = await simulatedAPI.getSettings();
                    if (savedSettings.adminName && savedSettings.adminName !== currentAdmin.full_name) {
                        currentAdmin.full_name = savedSettings.adminName;
                        localStorage.setItem('adminData', JSON.stringify(currentAdmin));
                    }
                    
                    // Update UI
                    updateAdminUI();
                    
                    closeModal('loginModal');
                    showSection('admin');
                    loadAdminData();
                    showAlert('Admin login successful!');
                    
                    // Clear login form
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                } else {
                    throw new Error(result.error || 'Login failed: Unknown error');
                }
            } catch (error) {
                console.error('Login error:', error);
                loginDebug.innerHTML += `<br>4. <strong style="color: red;">Login failed: ${error.message}</strong>`;
                showAlert('Login failed: ' + error.message, 'error');
            } finally {
                // Reset button state
                const loginBtn = document.getElementById('loginBtn');
                loginBtn.textContent = 'Login';
                loginBtn.disabled = false;
            }
        }

        // Update admin UI after login
        function updateAdminUI() {
            const adminInfo = document.getElementById('adminInfo');
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminName = document.getElementById('adminName');
            
            if (isAdminLoggedIn && currentAdmin) {
                adminInfo.style.display = 'flex';
                adminLoginBtn.style.display = 'none';
                // Use saved admin name from settings if available
                const savedSettings = JSON.parse(localStorage.getItem('adminSettings'));
                if (savedSettings && savedSettings.adminName) {
                    adminName.textContent = savedSettings.adminName;
                } else {
                    adminName.textContent = currentAdmin.full_name || currentAdmin.username;
                }
            } else {
                adminInfo.style.display = 'none';
                adminLoginBtn.style.display = 'block';
            }
        }

        // Update issue status (admin)
        async function updateIssueStatus() {
            const issueId = parseInt(document.getElementById('issueSelect').value);
            const newStatus = document.getElementById('statusUpdate').value;
            const deadline = document.getElementById('deadline').value;
            const notes = document.getElementById('adminNotes').value;
            
            if (!issueId) {
                showAlert('Please select an issue to update', 'error');
                return;
            }
            
            try {
                const updateData = {
                    status: newStatus
                };
                
                if (deadline) updateData.deadline = deadline;
                if (notes) updateData.admin_notes = notes;
                
                const result = await simulatedAPI.updateIssue(issueId, updateData);
                
                document.getElementById('adminSuccessModal').style.display = 'flex';
                loadAdminData();
                loadDashboardData();
                showAlert('Issue status updated successfully!');
                
                // Reset form
                document.getElementById('issueSelect').value = '';
                document.getElementById('statusUpdate').value = 'pending';
                document.getElementById('deadline').value = '';
                document.getElementById('adminNotes').value = '';
                
            } catch (error) {
                console.error('Error updating issue:', error);
                showAlert('Error updating issue: ' + error.message, 'error');
            }
        }

        // Generate report
        async function generateReport() {
            try {
                const reportType = document.getElementById('reportType').value;
                const reportPeriod = document.getElementById('reportPeriod').value;
                
                // Use simulated API for stats
                const stats = await simulatedAPI.getStats();
                
                document.getElementById('reportResults').style.display = 'block';
                document.getElementById('reportData').innerHTML = `
                    <div class="admin-stats">
                        <div class="admin-stat-card">
                            <div class="admin-stat-value">${stats.total || 0}</div>
                            <div class="admin-stat-label">Total Issues</div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="admin-stat-value">${stats.completed || 0}</div>
                            <div class="admin-stat-label">Resolved Issues</div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="admin-stat-value">${stats.inprogress || 0}</div>
                            <div class="admin-stat-label">In Progress</div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="admin-stat-value">${stats.pending || 0}</div>
                            <div class="admin-stat-label">Pending Issues</div>
                        </div>
                    </div>
                    <p><strong>Report Period:</strong> ${reportPeriod}</p>
                    <p><strong>Resolution Rate:</strong> ${stats.resolution_rate || 0}%</p>
                `;
                
            } catch (error) {
                console.error('Error generating report:', error);
                showAlert('Error generating report: ' + error.message, 'error');
            }
        }

        // Form submission - FIXED VERSION
        document.getElementById('issueForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                description: document.getElementById('issueDescription').value,
                location: document.getElementById('issueLocation').value,
                priority: document.getElementById('selectedPriority').value,
                media: [], // This will be populated from selectedFiles
                reporter: {
                    name: 'Anonymous User',
                    contact: null
                },
                status: 'pending'
            };
            
            // Validate required fields
            if (!formData.description || !formData.location) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            submitIssue(formData);
        });

        // Show section function
        function showSection(section) {
            // Hide all sections
            document.getElementById('home').style.display = 'none';
            document.getElementById('home-features').style.display = 'none';
            document.getElementById('report').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'none';
            
            // Show selected section
            if (section === 'home') {
                document.getElementById('home').style.display = 'block';
                document.getElementById('home-features').style.display = 'block';
            } else if (section === 'report') {
                document.getElementById('report').style.display = 'block';
            } else if (section === 'dashboard') {
                document.getElementById('dashboard').style.display = 'block';
                loadDashboardData();
            } else if (section === 'admin' && isAdminLoggedIn) {
                document.getElementById('admin-panel').style.display = 'block';
                loadAdminData();
            } else if (section === 'admin' && !isAdminLoggedIn) {
                showAlert('Please login as admin first', 'error');
                showLoginModal();
                return;
            }
            
            // Update active nav link
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            if (section === 'home') {
                document.querySelector('nav a[onclick="showSection(\'home\')"]').classList.add('active');
            }
        }

        // Show admin tab
        function showAdminTab(tab) {
            // Hide all admin tabs
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('admin-issues').style.display = 'none';
            document.getElementById('admin-reports').style.display = 'none';
            document.getElementById('admin-report-details').style.display = 'none';
            document.getElementById('admin-settings').style.display = 'none';
            
            // Show selected tab
            document.getElementById('admin-' + tab).style.display = 'block';
            
            // Load data when specific tabs are opened
            if (tab === 'reports') {
                loadAllReports();
            } else if (tab === 'settings') {
                loadSettings();
            }
            
            // Update active admin sidebar link
            document.querySelectorAll('.admin-sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the correct sidebar link
            const sidebarLink = document.querySelector(`.admin-sidebar a[onclick="showAdminTab('${tab}')"]`);
            if (sidebarLink) {
                sidebarLink.classList.add('active');
            }
        }

        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            // Pre-fill with demo credentials for testing
            document.getElementById('username').value = 'admin';
            document.getElementById('password').value = 'admin123';
        }

        // Admin logout function
        function adminLogout() {
            isAdminLoggedIn = false;
            authToken = null;
            currentAdmin = null;
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminData');
            updateAdminUI();
            showSection('home');
            showAlert('You have been logged out successfully.');
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            const modals = ['loginModal', 'successModal', 'adminSuccessModal', 'mediaModal', 'deleteConfirmModal'];
            
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Check for existing admin session on page load
        function checkAdminSession() {
            const savedToken = localStorage.getItem('adminToken');
            const savedAdmin = localStorage.getItem('adminData');
            
            if (savedToken && savedAdmin) {
                isAdminLoggedIn = true;
                authToken = savedToken;
                currentAdmin = JSON.parse(savedAdmin);
                updateAdminUI();
            }
        }

        // Handle Enter key in login form
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginModal').style.display === 'flex') {
                performAdminLogin();
            }
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Initialize database first
                await initDatabase();
                console.log('Database initialized successfully');
                
                // Then check admin session and load data
                checkAdminSession();
                showSection('home');
                loadDashboardData();
                
            } catch (error) {
                console.error('Error initializing application:', error);
                showAlert('Error initializing application. Please refresh the page.', 'error');
            }
        });
    </script>
</body>
</html>